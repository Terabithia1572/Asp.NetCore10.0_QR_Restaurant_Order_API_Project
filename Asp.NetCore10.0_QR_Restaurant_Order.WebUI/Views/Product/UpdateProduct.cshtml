@model UpdateProductDTO
@{
    ViewData["Title"] = "Ürün Güncelle";
    Layout = "~/Views/AdminLayout/Index.cshtml";
    ViewData["Breadcrumb"] = new List<(string Text, string Url)>
    {
        ("Ürünler", "/Product/ProductList/"),
        ("Ürün Güncelle", "")
    };
}

<div class="card bg-white p-20 rounded-10 border border-white mb-4">
    <form method="post" asp-action="UpdateProduct" enctype="multipart/form-data">
        <!-- Güncellemede ID ve mevcut görsel yolu kaybolmasın diye hidden gönderiyoruz -->
        <input asp-for="ProductID" type="hidden" />
        <input asp-for="ProductImageURL" type="hidden" />

        <div class="row">

            <!-- SOL TARAF -->
            <div class="col-lg-8">
                <h3 class="mb-20">Ürün Güncelle</h3>

                <div class="row">

                    <div class="col-lg-6">
                        <div class="mb-20">
                            <label class="label fs-16 mb-2">Ürün Adı</label>
                            <div class="form-floating">
                                <input asp-for="ProductName" type="text" class="form-control" id="floatingInput1" placeholder="Ürün Adı">
                                <label for="floatingInput1">Ürün Adı</label>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-6">
                        <div class="mb-20">
                            <label class="label fs-16 mb-2">Ürün Fiyatı</label>
                            <div class="form-floating">
                                <input asp-for="ProductPrice" type="number" step="0.01" class="form-control" id="floatingInput5" placeholder="Ürün Fiyatı">
                                <label for="floatingInput5">Ürün Fiyatı</label>
                            </div>
                        </div>
                    </div>

                    <!-- Ürün Görseli (Dosya Seç / Sürükle Bırak) -->
                    <div class="col-lg-12">
                        <div class="form-group mb-4 only-file-upload" id="file-upload">
                            <label class="label fs-16 mb-2 text-secondary">Ürün Görseli Güncelle</label>

                            <div class="form-control h-100 text-center position-relative p-4 p-lg-5" id="dropArea"
                                 style="cursor:pointer;">
                                <div class="product-upload">
                                    <label class="file-upload mb-0">
                                        <i class="ri-folder-image-line bg-primary bg-opacity-10 p-2 rounded-1 text-primary"></i>
                                        <span class="d-block text-body fs-14">
                                            Görseli sürükleyip bırak veya
                                            <span class="text-primary text-decoration-underline">Gözat</span>
                                        </span>
                                        <small class="text-muted d-block mt-1">JPG, PNG, WEBP önerilir</small>
                                    </label>

                                    <!-- input: dosya -->
                                    <label class="position-absolute top-0 bottom-0 start-0 end-0 cursor">
                                        <input asp-for="ProductImageFile" class="form__file bottom-0"
                                               id="upload-files" type="file" accept="image/*">
                                    </label>
                                </div>
                            </div>

                            <!-- Seçilen dosya adı / önizleme -->
                            <div class="mt-2 d-flex align-items-center gap-2">
                                <img id="previewImg" src="" alt=""
                                     style="width:48px;height:48px;object-fit:cover;display:none;border-radius:8px;" />
                                <span id="fileName" class="text-body fs-14"></span>
                            </div>

                            <!-- Mevcut görsel (Update'e özel) -->
                            @if (!string.IsNullOrEmpty(Model.ProductImageURL))
                            {
                                <div class="mt-3 d-flex align-items-center gap-2">
                                    <span class="text-secondary fs-14">Mevcut Görsel:</span>
                                    <img src="@Model.ProductImageURL"
                                         alt="Mevcut Görsel"
                                         style="width:48px;height:48px;object-fit:cover;border-radius:8px;border:1px solid rgba(0,0,0,.08);" />
                                    <span class="text-muted fs-13">Yeni görsel seçmezsen mevcut görsel korunur.</span>
                                </div>
                            }
                        </div>
                    </div>

                    <div class="col-lg-6">
                        <div class="mb-20">
                            <label class="label fs-16 mb-2">Durum</label>
                            <div class="form-floating">
                                <select asp-for="ProductStatus" class="form-select form-control" id="floatingSelectStatus">
                                    <option value="true">Aktif</option>
                                    <option value="false">Pasif</option>
                                </select>
                                <label for="floatingSelectStatus">Durum</label>
                            </div>
                        </div>
                    </div>

                    <!-- boşluğu koruyoruz -->
                    <div class="col-lg-6"></div>

                    <div class="col-lg-12">
                        <div class="form-group mb-20">
                            <label class="label fs-16 mb-2">Ürün Açıklaması</label>
                            <div class="form-floating">
                                <textarea asp-for="ProductDescription"
                                          class="form-control"
                                          id="floatingTextareaDesc"
                                          placeholder="Ürün açıklaması"
                                          style="height: 163px; border-color: #D5D9E2;"></textarea>
                                <label for="floatingTextareaDesc">Ürün açıklaması</label>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-12">
                        <div class="d-flex gap-2">
                            <button type="submit" class="btn btn-primary fw-normal text-white">Güncelle</button>
                            <a href="/Product/ProductList/" class="btn btn-danger fw-normal text-white">İptal</a>
                        </div>
                    </div>

                </div>
            </div>

            <!-- SAĞ TARAF (Kategori) -->
            <div class="col-lg-4">
                <h3 class="mb-20">Ürün Kategorisi</h3>

                <div class="mb-20">
                    <label class="label fs-16 mb-2">Kategori</label>
                    <div class="form-floating">
                        <select asp-for="CategoryID"
                                class="form-select form-control"
                                id="floatingSelect10"
                                asp-items="ViewBag.CategoryList">
                            <option value="">Seçiniz</option>
                        </select>
                        <label for="floatingSelect10">Seçiniz</label>
                    </div>
                </div>
            </div>

        </div>
    </form>
</div>

<script>
    // Drag & Drop + preview (Create ile birebir aynı)
    const dropArea = document.getElementById("dropArea");
    const fileInput = document.getElementById("upload-files");
    const fileName = document.getElementById("fileName");
    const previewImg = document.getElementById("previewImg");

    function showPreview(file) {
        if (!file) return;

        fileName.textContent = file.name;

        const url = URL.createObjectURL(file);
        previewImg.src = url;
        previewImg.style.display = "block";
    }

    fileInput.addEventListener("change", () => {
        const file = fileInput.files && fileInput.files[0];
        showPreview(file);
    });

    // sürükle bırak
    ["dragenter", "dragover"].forEach(evt => {
        dropArea.addEventListener(evt, e => {
            e.preventDefault();
            e.stopPropagation();
            dropArea.classList.add("border", "border-primary");
        });
    });

    ["dragleave", "drop"].forEach(evt => {
        dropArea.addEventListener(evt, e => {
            e.preventDefault();
            e.stopPropagation();
            dropArea.classList.remove("border", "border-primary");
        });
    });

    dropArea.addEventListener("drop", e => {
        const files = e.dataTransfer.files;
        if (!files || files.length === 0) return;

        fileInput.files = files;

        showPreview(files[0]);
    });
</script>
