@{
    ViewData["Title"] = "Mutfak Sipariş Listesi";
    Layout = "~/Views/AdminLayout/Index.cshtml";
    ViewData["Breadcrumb"] = new List<(string Text, string Url)>
    {
        ("Siparişler", "/Kitchen/Index/"),
        ("Mutfak Sipariş Listesi", "")
    };
}

<style>
    /* Yeni sipariş highlight efekti - temaya çok bulaşmadan hafif efekt */
    .kitchen-row-new {
        animation: kitchenRowHighlight 1.5s ease-out;
    }

    @@keyframes kitchenRowHighlight {
        0% {
            background-color: rgba(255, 214, 102, 0.5);
        }

        100% {
            background-color: transparent;
        }
    }

    .kitchen-time-text {
        font-size: 12px;
        color: #6c757d;
    }

    .kitchen-status-badge {
        font-size: 13px;
    }

    /* 🔹 Durum filtre butonları */
    .kitchen-filter-bar {
        gap: 0.25rem;
    }

    .kitchen-filter-btn.active {
        color: #fff !important;
    }

    /* 🔹 Süresi uzun sipariş vurgusu */
    .kitchen-time-high {
        color: #dc3545;
        font-weight: 600;
    }

    tr.kitchen-row-high {
        box-shadow: inset 3px 0 0 #dc3545;
    }

    /* 🔹 Detay modalı (temayı bozmadan basit bir overlay) */
    .kitchen-modal-backdrop {
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,0.5);
        z-index: 1040;
        display: none;
    }

        .kitchen-modal-backdrop.show {
            display: block;
        }

    .kitchen-modal {
        position: fixed;
        inset: 0;
        z-index: 1050;
        display: none;
        align-items: center;
        justify-content: center;
    }

        .kitchen-modal.show {
            display: flex;
        }

    .kitchen-modal-dialog {
        background: #ffffff;
        border-radius: 0.5rem;
        max-width: 720px;
        width: 100%;
        box-shadow: 0 0.75rem 1.5rem rgba(15,23,42,0.25);
        overflow: hidden;
    }

    .kitchen-modal-header,
    .kitchen-modal-footer {
        padding: 0.75rem 1rem;
        border-bottom: 1px solid #e5e7eb;
    }

    .kitchen-modal-footer {
        border-top: 1px solid #e5e7eb;
        border-bottom: none;
        display: flex;
        justify-content: flex-end;
        gap: 0.5rem;
    }

    .kitchen-modal-body {
        padding: 0.75rem 1rem;
        max-height: 60vh;
        overflow-y: auto;
    }

    .kitchen-modal-title {
        font-size: 1rem;
        font-weight: 600;
    }

    .kitchen-modal-meta {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        font-size: 0.875rem;
        margin-bottom: 0.75rem;
    }

        .kitchen-modal-meta .meta-label {
            color: #6c757d;
            margin-right: 4px;
        }

    .kitchen-modal-table th,
    .kitchen-modal-table td {
        font-size: 0.875rem;
        vertical-align: middle;
    }

    .kitchen-modal-close-btn {
        border: none;
        background: transparent;
        font-size: 1.1rem;
        line-height: 1;
        cursor: pointer;
        color: #6c757d;
    }
</style>

<div class="d-flex justify-content-between align-items-center mb-3">
    <h4 class="mb-0">Mutfak Sipariş Ekranı</h4>
    <span class="badge bg-info" id="kitchenConnectionStatus">Bağlanıyor...</span>
</div>

<!-- 🔹 Durum filtre barı -->
<div class="d-flex justify-content-between align-items-center mb-2 flex-wrap gap-2">
    <div class="btn-group btn-group-sm kitchen-filter-bar" role="group" aria-label="Durum Filtreleri">
        <button type="button" class="btn btn-outline-secondary active kitchen-filter-btn" data-filter="ALL">Hepsi</button>
        <button type="button" class="btn btn-outline-warning kitchen-filter-btn" data-filter="0">Yeni</button>
        <button type="button" class="btn btn-outline-info kitchen-filter-btn" data-filter="1">Onaylandı</button>
        <button type="button" class="btn btn-outline-primary kitchen-filter-btn" data-filter="2">Hazırlanıyor</button>
        <button type="button" class="btn btn-outline-success kitchen-filter-btn" data-filter="3">Hazır</button>
        <button type="button" class="btn btn-outline-secondary kitchen-filter-btn" data-filter="4">Servis Edildi</button>
        <button type="button" class="btn btn-outline-danger kitchen-filter-btn" data-filter="5">İptal</button>
    </div>
</div>

<div class="default-table-area mx-minus-1 table-to-do-list">
    <div class="table-responsive">
        <table class="table align-middle w-100">
            <thead>
                <tr>
                    <th scope="col" class="fw-medium">Sipariş</th>
                    <th scope="col" class="fw-medium">Masa</th>
                    <th scope="col" class="fw-medium">Tutar</th>
                    <th scope="col" class="fw-medium">Durum</th>
                    <th scope="col" class="fw-medium">Zaman</th>
                    <th scope="col" class="fw-medium text-end">İşlemler</th>
                </tr>
            </thead>

            <tbody id="kitchenOrdersBody">
                @* Satırlar JS ile dolduruluyor *@
            </tbody>
        </table>
    </div>

    <div class="d-flex justify-content-between align-items-center text-center flex-wrap gap-2 showing-wrap pt-15 p-20">
        <span class="fs-15 text-muted">
            Yeni siparişler anlık olarak bu listeye düşer. Durumu güncellediğinizde tüm ekranlar otomatik senkron olur.
        </span>
    </div>
</div>

<!-- Yeni sipariş sesi (dosyayı wwwroot/sounds/new-order.mp3 olarak sen ekleyeceksin) -->
<audio id="kitchenNewOrderSound" preload="auto">
    <source src="~/sounds/new-order.mp3" type="audio/mpeg" />
</audio>

<!-- 🔹 Sipariş Detay Modalı -->
<div class="kitchen-modal-backdrop" id="kitchenOrderModalBackdrop"></div>
<div class="kitchen-modal" id="kitchenOrderModal">
    <div class="kitchen-modal-dialog">
        <div class="kitchen-modal-header d-flex justify-content-between align-items-center">
            <h5 class="kitchen-modal-title mb-0">Sipariş Detayı</h5>
            <button type="button" class="kitchen-modal-close-btn" id="kitchenOrderModalClose">
                &times;
            </button>
        </div>
        <div class="kitchen-modal-body">
            <div class="kitchen-modal-meta">
                <div>
                    <span class="meta-label">Sipariş:</span>
                    <span class="meta-value" id="kitchenModalOrderId">-</span>
                </div>
                <div>
                    <span class="meta-label">Masa:</span>
                    <span class="meta-value" id="kitchenModalTable">-</span>
                </div>
                <div>
                    <span class="meta-label">Durum:</span>
                    <span class="meta-value" id="kitchenModalStatus">-</span>
                </div>
                <div>
                    <span class="meta-label">Toplam:</span>
                    <span class="meta-value" id="kitchenModalTotal">-</span>
                </div>
            </div>

            <div class="table-responsive">
                <table class="table table-sm kitchen-modal-table mb-0">
                    <thead>
                        <tr>
                            <th>Ürün</th>
                            <th class="text-center">Adet</th>
                            <th class="text-end">Birim</th>
                            <th class="text-end">Toplam</th>
                        </tr>
                    </thead>
                    <tbody id="kitchenModalItemsBody">
                        @* JS ile dolduruluyor *@
                    </tbody>
                </table>
            </div>
        </div>
        <div class="kitchen-modal-footer">
            <button type="button" class="btn btn-outline-secondary btn-sm" id="kitchenOrderModalCloseFooter">
                Kapat
            </button>
            @* İstersen buraya "Hazır olarak işaretle" gibi bir buton da bağlayabiliriz *@
        </div>
    </div>
</div>

@section Scripts {
    <!-- SignalR client (CDN üzerinden) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/8.0.0/signalr.min.js"></script>

    <script>
        // 🔧 BURAYI KENDİ WEBAPI ADRESİNE GÖRE GÜNCELLE:
        // Örn: https://localhost:7074 veya http://localhost:5074
        const apiBaseUrl = "https://localhost:7074"; // WebAPI adresin

        const connection = new signalR.HubConnectionBuilder()
            .withUrl(apiBaseUrl + "/signalrhub")
            .withAutomaticReconnect()
            .build();

        const statusBadge = document.getElementById("kitchenConnectionStatus");
        const tbody = document.getElementById("kitchenOrdersBody");
        const newOrderSound = document.getElementById("kitchenNewOrderSound");

        // 🔹 Modal elementleri
        let kitchenModal = null;
        let kitchenModalBackdrop = null;
        let kitchenModalOrderId = null;
        let kitchenModalTable = null;
        let kitchenModalStatus = null;
        let kitchenModalTotal = null;
        let kitchenModalItemsBody = null;

        function setStatus(text, cssClass) {
            if (!statusBadge) return;
            statusBadge.textContent = text;
            statusBadge.className = "badge " + cssClass;
        }

        function getStatusText(status) {
            switch (status) {
                case 0: return "Yeni Sipariş";
                case 1: return "Onaylandı";
                case 2: return "Hazırlanıyor";
                case 3: return "Hazır";
                case 4: return "Servis Edildi";
                case 5: return "İptal Edildi";
                default: return "Bilinmeyen";
            }
        }

        function getStatusBadgeClass(status) {
            // Temadaki badge stilini kullanalım
            switch (status) {
                case 0: return "text-warning bg-warning bg-opacity-10 fs-15 fw-normal d-inline-block default-badge";
                case 1: return "text-info bg-info bg-opacity-10 fs-15 fw-normal d-inline-block default-badge";
                case 2: return "text-primary bg-primary bg-opacity-10 fs-15 fw-normal d-inline-block default-badge";
                case 3: return "text-success bg-success bg-opacity-10 fs-15 fw-normal d-inline-block default-badge";
                case 4: return "text-secondary bg-secondary bg-opacity-10 fs-15 fw-normal d-inline-block default-badge";
                case 5: return "text-danger bg-danger bg-opacity-10 fs-15 fw-normal d-inline-block default-badge";
                default: return "text-body bg-light bg-opacity-10 fs-15 fw-normal d-inline-block default-badge";
            }
        }

        function getNextStatusAction(status) {
            switch (status) {
                case 0:
                    return { nextStatus: 1, text: "Onayla", btnClass: "btn-outline-info btn-sm" };
                case 1:
                    return { nextStatus: 2, text: "Hazırlanıyor", btnClass: "btn-outline-primary btn-sm" };
                case 2:
                    return { nextStatus: 3, text: "Hazır", btnClass: "btn-outline-success btn-sm" };
                case 3:
                    return { nextStatus: 4, text: "Servis Edildi", btnClass: "btn-outline-secondary btn-sm" };
                default:
                    return null;
            }
        }

        function playNewOrderSound() {
            try {
                if (newOrderSound) {
                    newOrderSound.currentTime = 0;
                    newOrderSound.play().catch(() => { });
                }
            } catch (e) {
                console.warn("Ses çalınamadı:", e);
            }
        }

        // 🔵 Yeni sipariş olayı
        connection.on("OrderCreated", function (order) {
            console.log("SignalR - Yeni sipariş:", order);
            addOrUpdateOrderRow(order, { placeOnTop: true, highlight: true }); // en üste + highlight
            playNewOrderSound();
        });

        // 🟡 Durum değişti olayı
        connection.on("OrderStatusChanged", function (order) {
            console.log("SignalR - Sipariş durumu güncellendi:", order);
            addOrUpdateOrderRow(order, { placeOnTop: false, highlight: false }); // satır yerinde kalsın
        });

        // 🔧 Satır ekleme/güncelleme
        function addOrUpdateOrderRow(order, options) {
            const placeOnTop = options?.placeOnTop ?? false;
            const highlight = options?.highlight ?? false;

            const id =
                order.orderId ?? order.OrderId ?? order.orderID ?? order.OrderID;

            const tableId =
                order.tableId ?? order.TableId ?? order.tableID ?? order.TableID;

            const total =
                order.totalPrice ?? order.TotalPrice ?? 0;

            const statusCode =
                order.orderStatus ?? order.OrderStatus ?? 0;

            const statusText =
                order.statusText ?? order.StatusText ?? order.statusDisplayName ?? order.StatusDisplayName ?? getStatusText(statusCode);

            const created =
                order.createdDate ?? order.CreatedDate ?? order.changedAt ?? order.ChangedAt ?? new Date();

            if (!id) {
                console.warn("Order ID bulunamadı, satır eklenmedi.", order);
                return;
            }

            let row = tbody.querySelector(`tr[data-order-id="${id}"]`);
            const isRowNew = !row;

            if (!row) {
                row = document.createElement("tr");
                row.setAttribute("data-order-id", id);
                row.innerHTML = `
                    <td class="kitchen-order-id"></td>
                    <td class="kitchen-order-table"></td>
                    <td class="kitchen-order-total"></td>
                    <td class="kitchen-order-status"></td>
                    <td class="kitchen-order-time"></td>
                    <td class="kitchen-order-actions text-end"></td>
                `;

                if (placeOnTop && tbody.firstChild) {
                    // Yeni sipariş → en üste
                    tbody.insertBefore(row, tbody.firstChild);
                } else {
                    // Initial load veya status değişikliği (yeni satır) → alta ekle
                    tbody.appendChild(row);
                }
            }

            const createdDateObj = new Date(created);
            if (!isNaN(createdDateObj.getTime())) {
                row.dataset.createdAt = createdDateObj.toISOString();
            }

            // 🔹 Filtreler için status kodunu data attribute olarak tut
            row.dataset.statusCode = statusCode;

            row.querySelector(".kitchen-order-id").textContent = "#" + id;
            row.querySelector(".kitchen-order-table").textContent = "Masa #" + (tableId ?? "?");

            const totalCell = row.querySelector(".kitchen-order-total");
            if (totalCell) {
                if (total !== null && total !== undefined && !isNaN(total)) {
                    totalCell.textContent = Number(total)
                        .toLocaleString("tr-TR", { style: "currency", currency: "TRY" });
                } else {
                    totalCell.textContent = "-";
                }
            }

            const statusCell = row.querySelector(".kitchen-order-status");
            if (statusCell) {
                const badgeClass = getStatusBadgeClass(statusCode);
                statusCell.innerHTML = `
                    <span class="kitchen-status-badge ${badgeClass}">${statusText}</span>
                `;
            }

            updateRowTime(row);

            const actionsCell = row.querySelector(".kitchen-order-actions");
            if (actionsCell) {
                const action = getNextStatusAction(statusCode);
                if (action) {
                    actionsCell.innerHTML = `
                        <div class="btn-group btn-group-sm" role="group">
                            <button
                                type="button"
                                class="btn ${action.btnClass} kitchen-status-btn"
                                data-order-id="${id}"
                                data-next-status="${action.nextStatus}">
                                ${action.text}
                            </button>
                            <button
                                type="button"
                                class="btn btn-outline-secondary kitchen-detail-btn"
                                data-order-id="${id}">
                                Detay
                            </button>
                        </div>
                    `;
                } else {
                    actionsCell.innerHTML = `
                        <button
                            type="button"
                            class="btn btn-outline-secondary btn-sm kitchen-detail-btn"
                            data-order-id="${id}">
                            Detay
                        </button>
                    `;
                }
            }

            if (highlight && isRowNew) {
                row.classList.add("kitchen-row-new");
                setTimeout(() => {
                    row.classList.remove("kitchen-row-new");
                }, 1500);
            }
        }

        function updateRowTime(row) {
            const timeCell = row.querySelector(".kitchen-order-time");
            if (!timeCell) return;

            const createdIso = row.dataset.createdAt;
            if (!createdIso) {
                timeCell.textContent = "";
                return;
            }

            const createdDate = new Date(createdIso);
            if (isNaN(createdDate.getTime())) {
                timeCell.textContent = "";
                return;
            }

            const now = new Date();
            const diffMs = now - createdDate;
            const diffMin = Math.floor(diffMs / 60000);

            const timeText = createdDate.toLocaleTimeString("tr-TR", {
                hour: "2-digit",
                minute: "2-digit"
            });

            let agoText = "";
            if (diffMin <= 0) {
                agoText = "şimdi";
            } else if (diffMin === 1) {
                agoText = "1 dk önce";
            } else {
                agoText = diffMin + " dk önce";
            }

            timeCell.innerHTML = `
                <div>${timeText}</div>
                <div class="kitchen-time-text">${agoText}</div>
            `;

            // 🔹 20 dakikadan uzun siparişleri vurgula
            timeCell.classList.remove("kitchen-time-high");
            row.classList.remove("kitchen-row-high");

            const threshold = 20; // dk
            if (diffMin >= threshold) {
                timeCell.classList.add("kitchen-time-high");
                row.classList.add("kitchen-row-high");
            }
        }

        function startTimeUpdater() {
            setInterval(() => {
                const rows = tbody.querySelectorAll("tr[data-order-id]");
                rows.forEach(row => updateRowTime(row));
            }, 30000);
        }

        // 🔹 Satır içi tıklamalar: Durum değiştir + Detay aç
        tbody.addEventListener("click", function (e) {
            const statusBtn = e.target.closest(".kitchen-status-btn");
            if (statusBtn) {
                const orderId = statusBtn.getAttribute("data-order-id");
                const nextStatus = parseInt(statusBtn.getAttribute("data-next-status"));

                if (!orderId || isNaN(nextStatus)) return;

                if (!confirm("Bu siparişin durumunu '" + getStatusText(nextStatus) + "' olarak güncellemek istiyor musun?")) {
                    return;
                }

                fetch(apiBaseUrl + "/api/Orders/" + orderId + "/status", {
                    method: "PUT",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        orderStatus: nextStatus
                    })
                })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error("Status update failed: " + response.status);
                        }
                        return response.json().catch(() => ({}));
                    })
                    .then(data => {
                        console.log("Durum güncelleme başarılı:", data);
                    })
                    .catch(error => {
                        console.error("Durum güncelleme hatası:", error);
                        alert("Durum güncellenirken bir hata oluştu.");
                    });

                return; // status işlemini yaptıktan sonra çık
            }

            const detailBtn = e.target.closest(".kitchen-detail-btn");
            if (detailBtn) {
                const orderId = detailBtn.getAttribute("data-order-id");
                if (!orderId) return;

                openKitchenOrderModal(orderId);
            }
        });

        async function startConnection() {
            try {
                await connection.start();
                console.log("SignalR bağlantısı başarıyla kuruldu (Kitchen).");
                setStatus("Bağlı", "bg-success");
            } catch (err) {
                console.error("SignalR bağlantı hatası:", err);
                setStatus("Bağlantı hatası - tekrar denenecek", "bg-danger");
                setTimeout(startConnection, 5000);
            }
        }

        connection.onreconnecting(error => {
            console.warn("SignalR yeniden bağlanıyor...", error);
            setStatus("Yeniden bağlanıyor...", "bg-warning text-dark");
        });

        connection.onreconnected(connectionId => {
            console.log("SignalR yeniden bağlandı. ConnectionId:", connectionId);
            setStatus("Bağlı", "bg-success");
        });

        connection.onclose(error => {
            console.warn("SignalR bağlantısı kapandı.", error);
            setStatus("Bağlı değil", "bg-secondary");
        });

        function loadInitialOrders() {
            fetch(apiBaseUrl + "/api/Orders/kitchen-active")
                .then(response => {
                    if (!response.ok) {
                        throw new Error("Kitchen-active isteği başarısız: " + response.status);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log("Initial kitchen orders:", data);
                    if (Array.isArray(data)) {
                        data.forEach(order =>
                            addOrUpdateOrderRow(order, { placeOnTop: false, highlight: false })
                        );
                    }
                })
                .catch(error => {
                    console.error("Initial kitchen orders yüklenirken hata:", error);
                });
        }

        // 🔹 Durum filtreleri
        function initKitchenFilters() {
            const filterButtons = document.querySelectorAll(".kitchen-filter-btn");
            if (!filterButtons.length) return;

            filterButtons.forEach(btn => {
                btn.addEventListener("click", () => {
                    const filter = btn.getAttribute("data-filter"); // ALL veya 0-5

                    filterButtons.forEach(b => b.classList.remove("active"));
                    btn.classList.add("active");

                    const rows = tbody.querySelectorAll("tr[data-order-id]");
                    rows.forEach(row => {
                        const rowStatus = row.dataset.statusCode;
                        if (filter === "ALL" || rowStatus === filter) {
                            row.classList.remove("d-none");
                        } else {
                            row.classList.add("d-none");
                        }
                    });
                });
            });
        }

        // 🔹 Detay modal fonksiyonları
        function showKitchenModal() {
            if (!kitchenModal || !kitchenModalBackdrop) return;

            kitchenModal.classList.add("show");
            kitchenModalBackdrop.classList.add("show");
            document.body.classList.add("overflow-hidden");
        }

        function hideKitchenModal() {
            if (!kitchenModal || !kitchenModalBackdrop) return;

            kitchenModal.classList.remove("show");
            kitchenModalBackdrop.classList.remove("show");
            document.body.classList.remove("overflow-hidden");

            if (kitchenModalItemsBody) {
                kitchenModalItemsBody.innerHTML = "";
            }
        }

        function openKitchenOrderModal(orderId) {
            if (!orderId) return;

            // API endpoint: Detay JSON'ı
            // Örnek: GET /api/Orders/{id}/detail
            fetch(apiBaseUrl + "/api/Orders/" + orderId + "/detail")
                .then(response => {
                    if (!response.ok) {
                        throw new Error("Detay isteği başarısız: " + response.status);
                    }
                    return response.json();
                })
                .then(data => {
                    // Beklenen örnek JSON:
                    // {
                    //   orderId: 1,
                    //   tableNumber: 5,
                    //   status: 2,
                    //   statusText: "Hazırlanıyor",
                    //   total: 350,
                    //   items: [
                    //     { productName: "Burger", quantity: 2, unitPrice: 120, lineTotal: 240 },
                    //     ...
                    //   ]
                    // }

                    if (kitchenModalOrderId) {
                        kitchenModalOrderId.textContent = "#" + (data.orderId ?? data.orderID ?? "");
                    }
                    if (kitchenModalTable) {
                        kitchenModalTable.textContent = "Masa #" + (data.tableNumber ?? data.tableNo ?? "?");
                    }
                    if (kitchenModalStatus) {
                        const stText = data.statusText ?? getStatusText(data.status ?? data.orderStatus ?? 0);
                        kitchenModalStatus.textContent = stText;
                    }
                    if (kitchenModalTotal) {
                        const total = data.total ?? data.totalPrice ?? 0;
                        kitchenModalTotal.textContent = Number(total)
                            .toLocaleString("tr-TR", { style: "currency", currency: "TRY" });
                    }

                    if (kitchenModalItemsBody) {
                        kitchenModalItemsBody.innerHTML = "";
                        const items = data.items ?? [];
                        items.forEach(item => {
                            const tr = document.createElement("tr");
                            const quantity = item.quantity ?? 0;
                            const unit = item.unitPrice ?? item.price ?? 0;
                            const line = item.lineTotal ?? item.total ?? (quantity * unit);

                            tr.innerHTML = `
                                <td>${item.productName ?? "-"}</td>
                                <td class="text-center">${quantity}</td>
                                <td class="text-end">
                                    ${Number(unit).toLocaleString("tr-TR", { style: "currency", currency: "TRY" })}
                                </td>
                                <td class="text-end">
                                    ${Number(line).toLocaleString("tr-TR", { style: "currency", currency: "TRY" })}
                                </td>
                            `;
                            kitchenModalItemsBody.appendChild(tr);
                        });
                    }

                    showKitchenModal();
                })
                .catch(error => {
                    console.error("Sipariş detayı alınırken hata:", error);
                    alert("Sipariş detayı alınırken bir hata oluştu.");
                });
        }

        document.addEventListener("DOMContentLoaded", function () {
            setStatus("Bağlanıyor...", "bg-info");
            loadInitialOrders();
            startConnection();
            startTimeUpdater();
            initKitchenFilters();

            // Modal elemanlarını DOM yüklendikten sonra bağla
            kitchenModal = document.getElementById("kitchenOrderModal");
            kitchenModalBackdrop = document.getElementById("kitchenOrderModalBackdrop");
            kitchenModalOrderId = document.getElementById("kitchenModalOrderId");
            kitchenModalTable = document.getElementById("kitchenModalTable");
            kitchenModalStatus = document.getElementById("kitchenModalStatus");
            kitchenModalTotal = document.getElementById("kitchenModalTotal");
            kitchenModalItemsBody = document.getElementById("kitchenModalItemsBody");

            const modalCloseBtn = document.getElementById("kitchenOrderModalClose");
            const modalCloseFooterBtn = document.getElementById("kitchenOrderModalCloseFooter");

            if (modalCloseBtn) {
                modalCloseBtn.addEventListener("click", hideKitchenModal);
            }
            if (modalCloseFooterBtn) {
                modalCloseFooterBtn.addEventListener("click", hideKitchenModal);
            }
            if (kitchenModalBackdrop) {
                kitchenModalBackdrop.addEventListener("click", hideKitchenModal);
            }
        });
    </script>
}
